## 分布式锁

1、redis

> SETNX 是SET if Not eXists的简写。将 key 的值设为 value，当且仅当 key 不存在; 若给定的 key 已经存在，则 SETNX 不做任何动作。
>
> expire命令为 key 设置生存时间，当 key 过期时(生存时间为 0 )，它会被自动删除。

基于以上两个命令可以实现分布式锁：

1、锁抢占：setnx 命令本身拥有这一特质

2、可重入：只需要在使用setnx 设置value的值为当前机器+应用+线程的名称即可，当获取到value后判断是否当前线程所持有，如果是则无需setnx执行成功，也可以持有。

3、超时自动释放锁防止死锁 或 程序自动释放：使用expire 为当前key设置超时时间。

4、为了防止上面两个命令因网络抖动有其中一个命令执行失败：可以使用批两执行

​	4.1、m命令不行：比如msetnx 只是对setnx 操作批量执行（单个命令执行多条数据）。而且expire 不支持

​	4.2、pipline 不能保证原子性

​	



